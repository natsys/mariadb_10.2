# What if ngram parser was used for an index, but server started without ngram
# plugin?

SET NAMES utf8mb4;

CREATE TABLE t (str TEXT, FULLTEXT(str) WITH PARSER ngram)
  ENGINE=InnoDB;

INSERT INTO t VALUES ("Hello World"), ("abcdef ghijklm");

--echo # Restart with ngram plugin disabled.
# Since the plugin is in use, it will not unload.
--let $restart_parameters= --ngram=OFF
--source include/restart_mysqld.inc
SET NAMES utf8mb4;

--error ER_PLUGIN_IS_NOT_LOADED
SELECT * FROM t WHERE MATCH(str) AGAINST('bcd') ORDER BY str;

--error ER_PLUGIN_IS_NOT_LOADED
SELECT * FROM t ORDER BY str;

--error ER_PLUGIN_IS_NOT_LOADED
INSERT INTO t VALUES ("something");

--echo # Restart with ngram plugin enabled again.
--let $restart_parameters=
--source include/restart_mysqld.inc
SET NAMES utf8mb4;

SELECT * FROM t WHERE MATCH(str) AGAINST('bcd') ORDER BY str;
SELECT * FROM t ORDER BY str;
INSERT INTO t VALUES ("something");

DROP TABLE t;
