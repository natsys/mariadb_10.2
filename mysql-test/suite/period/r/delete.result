create or replace table t (id int, s date, e date, period for apptime(s,e));
insert into t values(1, '1999-01-01', '2018-12-12');
insert into t values(1, '1999-01-01', '2017-01-01');
insert into t values(1, '2017-01-01', '2019-01-01');
insert into t values(2, '1998-01-01', '2018-12-12');
insert into t values(3, '1997-01-01', '2015-01-01');
insert into t values(4, '2016-01-01', '2020-01-01');
create or replace table t1 (id int, s date, e date, period for apptime(s,e));
insert t1 select * from t;
create or replace table t2 (id int, s date, e date, period for apptime(s,e));
insert t2 select * from t;
delete from t for portion of apptime from '2000-01-01' to '2018-01-01';
delete from t1 for portion of APPTIME from '2000-01-01' to '2018-01-01';
select * from t;
id	s	e
1	1999-01-01	2000-01-01
1	1999-01-01	2000-01-01
1	2018-01-01	2019-01-01
2	1998-01-01	2000-01-01
3	1997-01-01	2000-01-01
4	2018-01-01	2020-01-01
1	2018-01-01	2018-12-12
2	2018-01-01	2018-12-12
select * from t1 order by id, s, e;
id	s	e
1	1999-01-01	2000-01-01
1	1999-01-01	2000-01-01
1	2018-01-01	2018-12-12
1	2018-01-01	2019-01-01
2	1998-01-01	2000-01-01
2	2018-01-01	2018-12-12
3	1997-01-01	2000-01-01
4	2018-01-01	2020-01-01
select * from log_tbl;
log
>DEL: 1, 1999-01-01, 2018-12-12
<DEL: 1, 1999-01-01, 2018-12-12
>INS: 1, 1999-01-01, 2000-01-01
<INS: 1, 1999-01-01, 2000-01-01
>INS: 1, 2018-01-01, 2018-12-12
<INS: 1, 2018-01-01, 2018-12-12
>DEL: 1, 1999-01-01, 2017-01-01
<DEL: 1, 1999-01-01, 2017-01-01
>INS: 1, 1999-01-01, 2000-01-01
<INS: 1, 1999-01-01, 2000-01-01
>DEL: 1, 2017-01-01, 2019-01-01
<DEL: 1, 2017-01-01, 2019-01-01
>INS: 1, 2018-01-01, 2019-01-01
<INS: 1, 2018-01-01, 2019-01-01
>DEL: 2, 1998-01-01, 2018-12-12
<DEL: 2, 1998-01-01, 2018-12-12
>INS: 2, 1998-01-01, 2000-01-01
<INS: 2, 1998-01-01, 2000-01-01
>INS: 2, 2018-01-01, 2018-12-12
<INS: 2, 2018-01-01, 2018-12-12
>DEL: 3, 1997-01-01, 2015-01-01
<DEL: 3, 1997-01-01, 2015-01-01
>INS: 3, 1997-01-01, 2000-01-01
<INS: 3, 1997-01-01, 2000-01-01
>DEL: 4, 2016-01-01, 2020-01-01
<DEL: 4, 2016-01-01, 2020-01-01
>INS: 4, 2018-01-01, 2020-01-01
<INS: 4, 2018-01-01, 2020-01-01
# INSERT trigger only also works
drop trigger tr1del_t2;
drop trigger tr2del_t2;
delete from t2 for portion of APPTIME from '2000-01-01' to '2018-01-01';
select * from log_tbl;
log
>INS: 1, 1999-01-01, 2000-01-01
<INS: 1, 1999-01-01, 2000-01-01
>INS: 1, 2018-01-01, 2018-12-12
<INS: 1, 2018-01-01, 2018-12-12
>INS: 1, 1999-01-01, 2000-01-01
<INS: 1, 1999-01-01, 2000-01-01
>INS: 1, 2018-01-01, 2019-01-01
<INS: 1, 2018-01-01, 2019-01-01
>INS: 2, 1998-01-01, 2000-01-01
<INS: 2, 1998-01-01, 2000-01-01
>INS: 2, 2018-01-01, 2018-12-12
<INS: 2, 2018-01-01, 2018-12-12
>INS: 3, 1997-01-01, 2000-01-01
<INS: 3, 1997-01-01, 2000-01-01
>INS: 4, 2018-01-01, 2020-01-01
<INS: 4, 2018-01-01, 2020-01-01
delete history from t2 for portion of apptime from '2000-01-01' to '2018-01-01';
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '' at line 1
delete from t for portion of othertime from '2000-01-01' to '2018-01-01';
ERROR HY000: period `othertime` is not found in table
delete from t for portion of system_time from '2000-01-01' to '2018-01-01';
ERROR HY000: period SYSTEM_TIME is not allowed here
create or replace table t (id int, str text, s date, e date,
period for apptime(s,e));
insert into t values(1, 'data', '1999-01-01', '2018-12-12');
insert into t values(1, 'other data', '1999-01-01', '2018-12-12');
insert into t values(1, 'deleted', '2000-01-01', '2018-01-01');
delete from t for portion of apptime from '2000-01-01' to '2018-01-01';
show warnings;
Level	Code	Message
select * from t;
id	str	s	e
1	data	1999-01-01	2000-01-01
1	other data	1999-01-01	2000-01-01
1	data	2018-01-01	2018-12-12
1	other data	2018-01-01	2018-12-12
drop table t1;
# SQL17 Case 15.7-8.b.i
# If the column descriptor that corresponds to the i-th field of BR
# describes an identity column, a generated column, a system-time period
# start column, or a system-time period end column, then let V i be
# DEFAULT.
# auto_inrement field is updated
create or replace table t (id int primary key auto_increment, s date, e date,
period for apptime(s, e));
insert into t values (default, '1999-01-01', '2018-12-12');
delete from t for portion of apptime from '2000-01-01' to '2018-01-01';
select * from t;
id	s	e
2	1999-01-01	2000-01-01
3	2018-01-01	2018-12-12
truncate t;
# same for trigger case
insert into t values (default, '1999-01-01', '2018-12-12');
delete from t for portion of apptime from '2000-01-01' to '2018-01-01';
select * from t;
id	s	e
2	1999-01-01	2000-01-01
3	2018-01-01	2018-12-12
select * from log_tbl;
log
>DEL: 1999-01-01, 2018-12-12
<DEL: 1999-01-01, 2018-12-12
>INS: 1999-01-01, 2000-01-01
<INS: 1999-01-01, 2000-01-01
>INS: 2018-01-01, 2018-12-12
<INS: 2018-01-01, 2018-12-12
# generated columns are updated
create or replace table t (s date, e date,
xs date as (s) stored, xe date as (e) stored,
period for apptime(s, e));
insert into t values('1999-01-01', '2018-12-12', default, default);
select * from t;
s	e	xs	xe
1999-01-01	2018-12-12	1999-01-01	2018-12-12
delete from t for portion of apptime from '2000-01-01' to '2018-01-01';
select * from t;
s	e	xs	xe
1999-01-01	2000-01-01	1999-01-01	2000-01-01
2018-01-01	2018-12-12	2018-01-01	2018-12-12
truncate t;
# same for trigger case
insert into t values('1999-01-01', '2018-12-12', default, default);
delete from t for portion of apptime from '2000-01-01' to '2018-01-01';
select * from t;
s	e	xs	xe
1999-01-01	2000-01-01	1999-01-01	2000-01-01
2018-01-01	2018-12-12	2018-01-01	2018-12-12
select * from log_tbl;
log
>DEL: 1999-01-01, 2018-12-12
<DEL: 1999-01-01, 2018-12-12
>INS: 1999-01-01, 2000-01-01
<INS: 1999-01-01, 2000-01-01
>INS: 2018-01-01, 2018-12-12
<INS: 2018-01-01, 2018-12-12
# system_time columns are updated
create or replace table t (
s date, e date,
row_start SYS_TYPE as row start invisible,
row_end SYS_TYPE as row end invisible,
period for apptime(s, e),
period for system_time (row_start, row_end)) with system versioning;
insert into t values('1999-01-01', '2018-12-12'),
('1999-01-01', '1999-12-12');
select row_start into @ins_time from t limit 1;
select * from t order by s, e;
s	e
1999-01-01	1999-12-12
1999-01-01	2018-12-12
delete from t for portion of apptime from '2000-01-01' to '2018-01-01';
select *, if(row_start = @ins_time, "OLD", "NEW"), check_row(row_start, row_end)
from t for system_time all
order by s, e, row_start;
s	e	if(row_start = @ins_time, "OLD", "NEW")	check_row(row_start, row_end)
1999-01-01	1999-12-12	OLD	CURRENT ROW
1999-01-01	2000-01-01	NEW	CURRENT ROW
1999-01-01	2018-12-12	OLD	HISTORICAL ROW
2018-01-01	2018-12-12	NEW	CURRENT ROW
# same for trigger case
delete from t;
delete history from t;
insert into t values('1999-01-01', '2018-12-12'),
('1999-01-01', '1999-12-12');
select row_start into @ins_time from t limit 1;
select * from t order by s, e;
s	e
1999-01-01	1999-12-12
1999-01-01	2018-12-12
delete from t for portion of apptime from '2000-01-01' to '2018-01-01';
select *, if(row_start = @ins_time, "OLD", "NEW"), check_row(row_start, row_end)
from t for system_time all
order by s, e, row_start;
s	e	if(row_start = @ins_time, "OLD", "NEW")	check_row(row_start, row_end)
1999-01-01	1999-12-12	OLD	CURRENT ROW
1999-01-01	2000-01-01	NEW	CURRENT ROW
1999-01-01	2018-12-12	OLD	HISTORICAL ROW
2018-01-01	2018-12-12	NEW	CURRENT ROW
select * from log_tbl;
log
>DEL: 1999-01-01, 2018-12-12
<DEL: 1999-01-01, 2018-12-12
>INS: 1999-01-01, 2000-01-01
<INS: 1999-01-01, 2000-01-01
>INS: 2018-01-01, 2018-12-12
<INS: 2018-01-01, 2018-12-12
create or replace database test;
