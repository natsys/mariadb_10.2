-- source include/have_innodb.inc

--disable_warnings
drop table if exists t1;
--enable_warnings

create table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_end timestamp(6) generated always as row end,
  period for system_time (Sys_start, Sys_end)
) with system versioning;
show create table t1;

--echo # Implicit fields test
create or replace table t1 (
  XNo int unsigned
) with system versioning;
show create table t1;

--error ER_SYS_START_MORE_THAN_ONCE
create or replace table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_start2 timestamp(6) generated always as row start,
  Sys_end timestamp(6) generated always as row end,
  period for system_time (Sys_start, Sys_end)
) with system versioning;

--error ER_PERIOD_FOR_SYSTEM_TIME_CONTAINS_WRONG_END_COLUMN
create or replace table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_end2 timestamp(6) generated always as row end,
  period for system_time (Sys_start, Sys_end)
) with system versioning;

--error ER_SYS_END_MORE_THAN_ONCE
create or replace table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_end timestamp(6) generated always as row end,
  Sys_end2 timestamp(6) generated always as row end,
  period for system_time (Sys_start, Sys_end)
) with system versioning;

--error ER_SYS_START_NOT_SPECIFIED
create or replace table t1 (
  XNo int unsigned,
  period for system_time (Sys_start, Sys_end)
) with system versioning;

--error ER_SYS_END_MORE_THAN_ONCE
create or replace table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_end timestamp(6) generated always as row end,
  Sys_end2 timestamp(6) generated always as row end,
  period for system_time (Sys_start, Sys_end)
);

--error ER_PERIOD_FOR_SYSTEM_TIME_CONTAINS_WRONG_START_COLUMN 
create or replace table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_end timestamp(6) generated always as row end,
  period for system_time (sys_insert, sys_remove)
) with system versioning;

--error ER_MISSING_WITH_SYSTEM_VERSIONING 
create or replace table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_end timestamp(6) generated always as row end,
  period for system_time (Sys_start, Sys_end)
);

--error ER_SYS_START_AND_SYS_END_SAME
create or replace table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_end timestamp(6) generated always as row end,
  period for system_time (Sys_start, Sys_start)
);

--error ER_SYS_START_FIELD_MUST_BE_TIMESTAMP
create or replace table t1 (
  XNo int unsigned,
  Sys_start int generated always as row start,
  Sys_end timestamp(6) generated always as row end,
  period for system_time (Sys_start, Sys_end)
) with system versioning;

--error ER_SYS_END_FIELD_MUST_BE_TIMESTAMP
create or replace table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_end int generated always as row end,
  period for system_time (Sys_start, Sys_end)
) with system versioning;

--error ER_SYS_START_FIELD_MUST_BE_BIGINT
create or replace table t1 (
  XNo int unsigned,
  Sys_start timestamp(6) generated always as row start,
  Sys_end bigint generated always as row end,
  period for system_time (Sys_start, Sys_end)
) with system versioning engine innodb;

--error ER_SYS_START_FIELD_MUST_BE_BIGINT
create or replace table t1 (
  XNo int unsigned,
  Sys_start bigint generated always as row start,
  Sys_end bigint generated always as row end,
  period for system_time (Sys_start, Sys_end)
) with system versioning engine innodb;

--error ER_SYS_END_FIELD_MUST_BE_BIGINT
create or replace table t1 (
  XNo int unsigned,
  Sys_start bigint unsigned generated always as row start,
  Sys_end bigint generated always as row end,
  period for system_time (Sys_start, Sys_end)
) with system versioning engine innodb;

create or replace table t1 (
  A int with system versioning,
  B int
);
show create table t1;

create or replace table t1 (
  A int with system versioning,
  B int
) with system versioning;
show create table t1;

--error ER_NO_VERSIONED_FIELDS_IN_VERSIONED_TABLE
create or replace table t1 (
  A int,
  B int without system versioning
);

create or replace table t1 (
  A int,
  B int without system versioning
) with system versioning;
show create table t1;

create or replace table t1 (
  A int with system versioning,
  B int without system versioning
);
show create table t1;

create or replace table t1 (
  A int with system versioning,
  B int without system versioning
) with system versioning;
show create table t1;

--error ER_NO_VERSIONED_FIELDS_IN_VERSIONED_TABLE
create or replace table t1 (
  A int without system versioning
);

--error ER_NO_VERSIONED_FIELDS_IN_VERSIONED_TABLE
create or replace table t1 (
  A int without system versioning
) with system versioning;

drop table t1;
